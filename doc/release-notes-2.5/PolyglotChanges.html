<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../overview.css" type="text/css">
<title>Changes to Polyglot for Version 2.5</title>
<style>
  p { width: 100ex }
</style>

</head>
<body>
    <div class="content">

	<h1>Changes to Polyglot for Version 2.5</h1>

	<p>
		The way Polyglot handles intermediate source files and generated class
		files has been changed in version 2.5. In previous versions, the back
		end of the compiler was generating
		<tt>.java</tt>
		files which were stored to the file system and then handed off to
		<tt>javac</tt>
		, unless the
		<tt>-post</tt>
		option was given to specify a different post-compiler. The new
		standard behavior is to generate Java source code internally, and use
		the Java compiler support provided in the
		<tt><a href="http://docs.oracle.com/javase/6/docs/api/javax/tools/package-summary.html">javax.tools</a></tt>
		package to invoke
		<tt>javac</tt>
		within the same JVM as Polyglot itself. This change improves
		performance and lessens dependency on the file system. The original
		functionality is still available in version 2.5 via the
		<tt>-post</tt>
		option.
	</p>
	<p>
		The changes made to Polyglot are summarized below. Most Polyglot
		extensions should require few or no changes to work with version 2.5.
		If changes are required, the <a href="PortingGuide.html">Porting
			Guide</a> should be helpful.
	</p>

	<h2>Design Changes</h2>
	<p>The following changes to the design are also summarized in the
		UML diagram below.</p>
	<ul class="ulpara">
		<li><tt>polyglot.frontend.SourceLoader</tt> is now an interface.
			Implementation of this interface is now provided in <tt>polyglot.filemanager.ExtFileManager</tt>.</li>
		<li><tt>polyglot.types.reflect.ClassFileLoader</tt> is now an
			interface. Implementation of this interface is now provided in <tt>polyglot.filemanager.ExtFileManager</tt>.</li>
		<li><tt>polyglot.types.reflect.ClassPathLoader</tt> has been
			deleted.</li>
		<li><tt>polyglot.types.reflect.ClassFile</tt> is an interface and
			<tt>polyglot.types.reflect.ClassFile_c</tt> is an implementation of
			that interface.</li>
		<li><tt>polyglot.frontend.Source</tt> and <tt>FileSource</tt> are
			now interfaces. <tt>polyglot.frontend.Source_c</tt> implements <tt>FileSource</tt>.</li>
		<li>Setting of post-compiler classpath and full classpath has
			been deleted.</li>
	</ul>
	<h2>Additions</h2>
	<ul>
		<li><tt>polyglot.frontend.ExtensionInfo</tt> interface has an
			additional method <tt>classFileLoader()</tt> that creates a loader
			that loads <tt>.class</tt> files from multiple locations.</li>
		<li><tt>polyglot.filemanager.FileManager</tt> interface,
			extending
                    <tt>
                        <a href="http://docs.oracle.com/javase/6/docs/api/javax/tools/StandardJavaFileManager.html">
                            javax.tools.StandardJavaFileManager</a></tt>,
                        <tt>polyglot.frontend.SourceLoader</tt> and <tt>polyglot.types.reflect.ClassFileLoader</tt></li>
		<li><tt>polyglot.filemanager.ExtFileManager</tt> class,
			implementing the <tt>polyglot.filemanager.FileManager</tt> interface</li>
		<li><tt>polyglot.filemanager.SourceObject</tt> class, extending <tt>javax.tools.SimpleJavaFileObject</tt>
			to provide in-memory objects to hold translated Java code</li>
		<li><tt>polyglot.util.StringBuilderWriter</tt> class, providing a
			writer that writes to a StringBuilder</li>
	</ul>
	<p>
		NOTE: Instances of
		<tt>
			<a
				href="http://docs.oracle.com/javase/6/docs/api/javax/tools/JavaFileManager.Location.html">javax.tools.JavaFileManager.Location</a>
		</tt>
		in
		<tt>polyglot.filemanager.ExtFileManager</tt>
		are set in
		<tt>start()</tt>
		method (of
		<tt>polyglot.main.Main</tt>
		) by calling
		<tt>addLocationsToFileManager()</tt>
		method of
		<tt>polyglot.frontend.ExtensionInfo</tt>
		interface.
	</p>
	<br />
	<h2>FileManager implementation and associated SourceObject</h2>
        <p>
        The following UML diagrams show how the different parts of the new file manager implementation are composed.
        </p>
	<img alt="UML Diagram" src="PolyglotFileManager.png" width="100%"/>
    </div>
</body>
</html>
